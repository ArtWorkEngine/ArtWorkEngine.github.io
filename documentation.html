<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtWork Engine</title>
    <style>
        :root {
            --bg: #ffffff;
            --text: #000000;
            --header-bg: #0f0f0f;
            --header-text: #ffffff;
            --sidebar-bg: #f5f5f5;
            --border: #e0e0e0;
            --accent: #007acc;
        }

        .dark {
            --bg: #1b1b1b;
            --text: #e0e0e0;
            --header-bg: #0f0f0f;
            --header-text: #ffffff;
            --sidebar-bg: #2a2a2a;
            --border: #444444;
            --accent: #4da6ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            padding: 1rem;
            overflow-y: auto;
            position: sticky;
            top: 0;
            height: 100vh;
        }

        .sidebar h3 {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }

        .nav-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .nav-item:hover {
            color: var(--accent);
        }

        .nav-item.main {
            font-weight: 600;
            padding-left: 0;
        }

        .nav-item.sub {
            font-size: 0.85rem;
            padding-left: 1rem;
            color: #666;
        }

        .dark .nav-item.sub {
            color: #aaa;
        }

        .content {
            flex: 1;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .doc-title {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 2rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 0.5rem;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 500;
            margin: 2rem 0 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        h3 {
            font-size: 1.2rem;
            font-weight: 500;
            margin: 1.5rem 0 0.8rem;
        }

        .mini-title {
            font-weight: 600;
            margin: 1.2rem 0 0.5rem;
            color: var(--accent);
        }

        p {
            margin-bottom: 1rem;
        }

        .italic {
            font-style: italic;
            color: #666;
        }

        .dark .italic {
            color: #aaa;
        }

        code {
            background: var(--sidebar-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background: var(--sidebar-bg);
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid var(--border);
        }

        ul, ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .controls {
            position: fixed;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .lang-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .lang-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .theme-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="controls">
        <div class="lang-selector">
            <button class="lang-btn active" data-lang="ru">RU</button>
            <button class="lang-btn" data-lang="en">EN</button>
        </div>
        <button class="theme-btn" id="themeToggle">üåì</button>
    </div>

    <aside class="sidebar" id="sidebar">
        <h3>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h3>
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å–∫—Ä–∏–ø—Ç–æ–º -->
    </aside>

    <main class="content" id="content">
        <div class="doc-title">–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø</div>
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...</div>
    </main>

    <script>
        const themeToggle = document.getElementById('themeToggle');
        const langButtons = document.querySelectorAll('.lang-btn');
        const content = document.getElementById('content');
        const sidebar = document.getElementById('sidebar');
        let currentLang = 'ru';

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä lang –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const urlLang = urlParams.get('lang');
        const urlTheme = urlParams.get('theme');
        
        if (urlLang && (urlLang === 'ru' || urlLang === 'en')) {
            currentLang = urlLang;
            updateLangButtons();
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É –∏–∑ URL
        if (urlTheme === 'dark') {
            document.documentElement.classList.add('dark');
        } else if (urlTheme === 'light') {
            document.documentElement.classList.remove('dark');
        } else if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark');
        }

        loadDocumentation(currentLang);

        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateURL();
        });

        langButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const lang = btn.dataset.lang;
                if (lang === currentLang) return;
                
                currentLang = lang;
                updateLangButtons();
                loadDocumentation(lang);
                updateURL();
            });
        });

        function updateLangButtons() {
            langButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === currentLang);
            });
        }

        function updateURL() {
            const isDark = document.documentElement.classList.contains('dark');
            const url = new URL(window.location);
            url.searchParams.set('lang', currentLang);
            url.searchParams.set('theme', isDark ? 'dark' : 'light');
            window.history.pushState({}, '', url);
        }

        async function loadDocumentation(lang) {
            content.innerHTML = `
                <div class="doc-title">${lang === 'ru' ? '–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø' : 'DOCUMENTATION'}</div>
                <div class="loading">${lang === 'ru' ? '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...' : 'Loading documentation...'}</div>
            `;
            
            try {
                const response = await fetch(
                    `https://raw.githubusercontent.com/ArtWorkEngine/ArtWorkEngine.github.io/refs/heads/main/Documentation/${lang}`
                );
                
                if (!response.ok) throw new Error('Failed to load');
                
                const text = await response.text();
                const { html, navItems } = convertToHTML(text);
                content.innerHTML = `
                    <div class="doc-title">${lang === 'ru' ? '–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø' : 'DOCUMENTATION'}</div>
                    ${html}
                `;
                generateNavigation(navItems, lang);
                addAnchorLinks();
            } catch (error) {
                content.innerHTML = `
                    <div class="doc-title">${lang === 'ru' ? '–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø' : 'DOCUMENTATION'}</div>
                    <p>${lang === 'ru' ? '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.' : 'Failed to load documentation.'}</p>
                `;
                sidebar.innerHTML = '<h3>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h3>';
            }
        }

        function convertToHTML(text) {
            const lines = text.split('\n');
            let html = '';
            const navItems = [];
            let inPre = false;
            let currentId = 0;

            lines.forEach(line => {
                if (line.startsWith('```')) {
                    inPre = !inPre;
                    if (inPre) {
                        html += '<pre><code>';
                    } else {
                        html += '</code></pre>';
                    }
                    return;
                }

                if (inPre) {
                    html += line + '\n';
                    return;
                }

                // –°—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å # - –∫—É—Ä—Å–∏–≤–Ω—ã–µ
                if (line.trim().startsWith('#')) {
                    html += `<p class="italic">${line.substring(1).trim()}</p>`;
                    return;
                }

                // –ó–∞–≥–æ–ª–æ–≤–∫–∏ --–¢–ê–ö–ò–ï--
                if (line.includes('--') && line.indexOf('--') !== line.lastIndexOf('--')) {
                    const title = line.replace(/--/g, '').trim();
                    html += `<h2 id="section-${currentId}">${title}</h2>`;
                    navItems.push({ type: 'main', text: title, id: `section-${currentId}` });
                    currentId++;
                    return;
                }

                // –ú–∏–Ω–∏-–∑–∞–≥–æ–ª–æ–≤–∫–∏ (–∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ :)
                if (line.trim().endsWith(':') && line.trim().length > 1) {
                    html += `<h3 class="mini-title" id="mini-${currentId}">${line.trim()}</h3>`;
                    navItems.push({ type: 'sub', text: line.trim(), id: `mini-${currentId}` });
                    currentId++;
                    return;
                }

                // –û–±—ã—á–Ω—ã–µ –∞–±–∑–∞—Ü—ã
                if (line.trim()) {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º markdown-–ø–æ–¥–æ–±–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
                    let processedLine = line
                        .replace(/`([^`]+)`/g, '<code>$1</code>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>');
                    
                    html += `<p>${processedLine}</p>`;
                }
            });

            return { html, navItems };
        }

        function generateNavigation(items, lang) {
            let navHTML = '<h3>' + (lang === 'ru' ? '–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ' : 'Contents') + '</h3>';
            
            items.forEach(item => {
                const cls = item.type === 'main' ? 'nav-item main' : 'nav-item sub';
                navHTML += `<div class="${cls}" data-id="${item.id}">${item.text}</div>`;
            });
            
            sidebar.innerHTML = navHTML;

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const id = item.dataset.id;
                    const element = document.getElementById(id);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        }

        function addAnchorLinks() {
            // –î–æ–±–∞–≤–ª—è–µ–º —è–∫–æ—Ä—è –¥–ª—è –≤—Å–µ—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
            document.querySelectorAll('h2, .mini-title').forEach((heading, index) => {
                if (!heading.id) {
                    heading.id = `heading-${index}`;
                }
            });
        }
    </script>
</body>
</html>
